<!doctype html>
<html>
  <head>
    <title>Search My Routes - Shape Runner</title>
    <link rel="stylesheet" href="/styles.css">
  </head>

  <body>
    <!-- Navigation Bar -->
    <nav>
      <a href="/">Home</a>
      <a href="/about">About</a>
      <a href="/routes/generate">Generate Route</a>
      <a href="/runs/add">Log Run</a>
      <a href="/runs/search">My Runs</a>

      <span style="margin-left:auto;">
        <a href="/logout">Logout</a>
      </span>
    </nav>

    <div class="page">
      <h1>Search My Routes</h1>

      <div class="card">
        <h3>Search Filters</h3>

        <form method="GET" action="/routes/search">
          <label>Shape:
            <select name="shapeName">
              <option value="all" <%= form.shapeName === 'all' ? 'selected' : '' %>>All</option>
              <option value="square" <%= form.shapeName === 'square' ? 'selected' : '' %>>Square</option>
              <option value="triangle" <%= form.shapeName === 'triangle' ? 'selected' : '' %>>Triangle</option>
            </select>
          </label>

          <label>Min distance (km):
            <input type="number" step="0.1" name="minDistance" value="<%= form.minDistance %>">
          </label>

          <label>Max distance (km):
            <input type="number" step="0.1" name="maxDistance" value="<%= form.maxDistance %>">
          </label>

          <input type="submit" value="Search">
        </form>
      </div>

      <div class="card">
        <h3>Results</h3>

        <% if (routes.length === 0) { %>
          <p>No routes found. Try adjusting your filters.</p>
        <% } else { %>

          <table class="styled-table">
            <thead>
              <tr>
                <th>Name</th>
                <th>Shape</th>
                <th>Distance (km)</th>
                <th>Centre</th>
                <th>Created</th>
              </tr>
            </thead>
            <tbody>
              <% routes.forEach(function(route) { %>
                <tr>
                  <td><%= route.name %></td>
                  <td><%= route.shape_name %></td>

                  <td>
                    <% if (route.total_distance_km && !isNaN(route.total_distance_km)) { %>
                      <%= Number(route.total_distance_km).toFixed(2) %>
                    <% } else { %>
                      N/A
                    <% } %>
                  </td>

                  <td>
                    <% if (route.center_lat != null && !isNaN(route.center_lat) &&
                        route.center_lng != null && !isNaN(route.center_lng)) { %>
                      <%= Number(route.center_lat).toFixed(5) %>,
                      <%= Number(route.center_lng).toFixed(5) %>
                    <% } else { %>
                      -
                    <% } %>
                  </td>

                  <td>
                    <% if (route.created_at.toISOString) { %>
                      <%= route.created_at.toISOString().slice(0,16).replace("T"," ") %>
                    <% } else { %>
                      <%= route.created_at %>
                    <% } %>
                  </td>
                </tr>
              <% }) %>
            </tbody>
          </table>

        <% } %>

      </div>
    </div>
  </body>
</html>